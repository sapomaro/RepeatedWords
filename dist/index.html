<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css"></style>
    <style type="text/css">
html, body {
  position: relative; 
  width: 100%;
  min-height: 100%; 
  height: 100%; 
  margin: 0; 
  padding: 0; 
  background: #f3f3f3;
  font: 18px/18px "Arial Unicode",Arial,Helvetica,sans-serif;
}

.container {
  position: relative; 
  min-height: 100%; 
  height: 100%;
  width: 50em;
  margin: 0 auto;
}

@media (max-width:800px) {
  body {
    font-size: 24px; 
    line-height: 24px;
  }
  .container {
    width: 100%;
  }
}

.container-main {
  position: relative;
  width: 39em;
  vertical-align: top;
}
.container-controls {
  position: relative;
  width: 10em;
  padding-left: 1em;
  vertical-align: top;
}

.sticky-controls {
  position: sticky;
  top: 1em;
}

h1 {
  margin: 2ex 0;
  line-height: 1;
  color: #333;
}

table, tr, td {
  margin: 0;
  padding: 0;
  border: none;
}

.form-areaset {
  position: relative;
  min-height: 40ex;
  width: 100%;
  margin: 1ex 0;
  border: 2px solid #333;
  background: #fff;
}

.form-area {
  font: 100%/1 monospace; 
  display: block;
  border: none;
  resize: none;
  background: transparent;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  overflow: hidden; 
  outline: none;
}

.form-mock, .form-text {
  min-height: 40ex;
  width: 90%;
  padding: 5%;
  margin: 0;
}

.form-mock { 
  position: absolute; 
  z-index: 1; 
  color: #aaa; 
}

.form-text { 
  position: relative; 
  z-index: 2; 
  color: #333; 
}

.form-button, .form-field {
  font: 100%/1 monospace; 
  box-sizing: border-box;
  display: inline-block;
  min-height: 5ex;
  margin: 1ex 0;
  padding: 10px;
  border: 2px solid #333;
  outline: none;
  text-align: left;
  vertical-align: middle;
}

.form-button {
  width: 100%;
  background: #333;
  color: #fff;
  cursor: pointer;
  letter-spacing: -1px;
}

.form-field {
  width: 3em;
  text-align: center;
}
.form-comment {
  font-size: 90%;
  line-height: 90%;
  display: inline-block;
  width: 6em;
  vertical-align: middle;
}

h2 {
  font-size: inherit;
  margin: 1em 0;
  padding: 0;
  color: #333;
}

.form-summary {
  font-size: 90%;
  line-height: 90%;
  display: inline-block;
  box-sizing: border-box;
  width: 100%;
  padding: 0;
  margin: 1em 0;
  color: #333;
  letter-spacing: -1pt;
}

.form-button:active {
  transform: scale(0.98);
}

.form-button:disabled {
  background: #999;
  border-color: #999;
  color: #fff;
  transform: scale(1);
  cursor: not-allowed;
}

.form-field:disabled {
  border-color: #999;
  cursor: not-allowed;
}

.form-highlight { text-decoration: underline; }
.form-highlight0 { color: red; }
.form-highlight1 { color: gold; }
.form-highlight2 { color: blue; }
.form-highlight3 { color: fuchsia; }
.form-highlight4 { color: lime; }
.form-highlight5 { color: aqua; }
.form-highlight6 { color: green; }
.form-highlight7 { color: orange; }
.form-highlight8 { color: olive; }
.form-highlight9 { color: teal; }
    </style>
    <title>üîÅ –ü–æ–∏—Å–∫ –ø–æ–≤—Ç–æ—Ä–æ–≤ —Å–ª–æ–≤ v0.4.5</title>
  </head>
  <body lang="ru">
    <div class="container">
      <h1>–ü–æ–∏—Å–∫ –ø–æ–≤—Ç–æ—Ä–æ–≤ —Å–ª–æ–≤</h1>
      <form name="repetitions">
        <table>
          <tr><td class="container-main">
            <div class="form-areaset">
              <div id="mock" class="form-area form-mock"></div>
              <textarea name="text" class="form-area form-text" spellcheck="false"
                data-placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç..."></textarea>
            </div>
          </td>
          <td class="container-controls">
            <div class="sticky-controls">
              <button name="submit" class="form-button">
                <b id="indicator" data-idle-value="‚≠æ" data-loading-value="‚åõ"></b> 
                –ù–∞–π—Ç–∏ –ø–æ–≤—Ç–æ—Ä—ã 
              </button>
              <label>
                <input name="distance" class="form-field">&nbsp;
                <span class="form-comment">—Å–ª–æ–≤ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ –º–∞–∫—Å–∏–º—É–º</span>
              </label>
              <button name="clear" class="form-button">‚å¶ –û—á–∏—Å—Ç–∏—Ç—å</button>
              <button name="up" class="form-button"><b>‚≠±</b> –ù–∞–≤–µ—Ä—Ö</button>
              <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h2>
              <textarea name="summary" class="form-area form-summary" readonly="readonly"></textarea>
            </div>
          </td></tr>
        </table>
      </form>
      <br><br><br>
    </div>
  <script type="text/javascript">
    window.DuplicateWordsApp = {}; 

    window.DuplicateWordsApp.DuplicatesFinderModule = function(wordFormsHandler) {
  "use strict";

  var wordMatrix = {};

  wordMatrix.parseInputText = function(text) { // –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
    return text.toLowerCase()
      .replace(/—ë/g, '–µ')
      .split(/[^–∞-—èa-z]+/)
      .filter(String);
  };

  wordMatrix.build = function(text) {
    // —Å–æ–∑–¥–∞—ë—Ç –º–∞—Ç—Ä–∏—Ü—É –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–ª–æ–≤–æ—Ñ–æ—Ä–º (—Å–ª–æ–≤–æ —Ü–µ–ª–∏–∫–æ–º, –∫–æ—Ä–µ–Ω—å —Å–ª–æ–≤–∞, —Å–ª–æ–≤–æ –±–µ–∑ –ø—Ä–∏—Å—Ç–∞–≤–∫–∏, —Å–ª–æ–≤–æ –±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–∞)
    var wordsArray = this.parseInputText(text);
    var word = '';
    var wordForms = [];
    this.matrix = {};

    for (var pos = 0; pos < wordsArray.length; ++pos) {
      word = wordsArray[pos];

      if (!word) { continue; }
      if (word.length < 2) { continue; }

      wordForms = wordFormsHandler(word); // word, wordRoot, wordRootSuffixed, wordRootPrefixed

      for (var f = 0; f < wordForms.length; ++f) {
        if (f > 0 && word === wordForms[f]) { continue; }

        if ('undefined' === typeof this.matrix[wordForms[f]]) {
          this.matrix[wordForms[f]] = [pos];

        } else if (this.matrix[wordForms[f]].indexOf(pos) === -1) {
          this.matrix[wordForms[f]].push(pos);
        }
      }
    }

    this.compareEach();

    return this.matrix;
  };

  wordMatrix.compareEach = function() {
    // –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–π –º–∞—Ç—Ä–∏—Ü–µ —Å–ª–æ–≤–æ—Ñ–æ—Ä–º (–¥–ª—è —Å–ª–æ–≤ –¥–ª–∏–Ω–æ–π –Ω–µ –º–µ–Ω–µ–µ 7 –±—É–∫–≤)
    // –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    // —Ä–∞–Ω—å—à–µ –±—ã–ª–æ 6 –±—É–∫–≤, –Ω–æ –≤–æ–∑–Ω–∏–∫–ª–∏ –∫–æ–ª–ª–∏–∑–∏–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞-–ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ)
    for (var word in this.matrix) {
      if (word.length < 7) { continue; }
      if (this.matrix.hasOwnProperty(word) === false) { continue; }
      for (var word2 in this.matrix) {
        if (word2.length < 7) { continue; }
        if (this.matrix.hasOwnProperty(word2) === false) { continue; }
        if (this.matrix[word] === this.matrix[word2]) { continue; }

        this.compareLastLetter(word, word2);
      }
    }
  };

  wordMatrix.compareLastLetter = function(word, word2) {
    if (word.length === word2.length 
      && word.slice(0, word.length - 1) === word2.slice(0, word2.length - 1)) {
      // –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å–ª–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –±—É–∫–≤–∞ –≤ –∫–æ–Ω—Ü–µ
      var wordsMapChunk = this.matrix[word].concat(this.matrix[word2]);
      for (var pos = 0; pos < wordsMapChunk.length; ++pos) {
        wordsMapChunk[pos] = parseInt(wordsMapChunk[pos]);
        if (this.matrix[word].indexOf(wordsMapChunk[pos]) === -1) {
          this.matrix[word].push(wordsMapChunk[pos]);
        }
        if (this.matrix[word2].indexOf(wordsMapChunk[pos]) === -1) {
          this.matrix[word2].push(wordsMapChunk[pos]);
        }
      }
    }
  };

  wordMatrix.getRepetitions = function(searchDistance) {
    // –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
    if (!searchDistance) { searchDistance = 50; }
    var repetitions = [];
    var pairs = [];

    for (var word in this.matrix) {
      if (this.matrix.hasOwnProperty(word) === false) { continue; }
      if (this.matrix[word].length < 2) { continue; } // –ø—Ä–æ–ª–∏—Å—Ç—ã–≤–∞–µ–º —Å–ª–æ–≤–æ—Ñ–æ—Ä–º—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
      var wordPos = this.matrix[word].sort(function(a, b) { return a - b; });
      for (var i = 1; i < wordPos.length; ++i) {
        var wordsDistance = wordPos[i] - wordPos[i - 1];
        if (wordsDistance > 0 && wordsDistance < searchDistance) {
          if (pairs.indexOf(wordPos[i - 1]) === -1) {
            pairs.push(wordPos[i - 1]);
          }
          pairs.push(wordPos[i]);
        }
        else if (pairs.length > 1) {
          repetitions.push(pairs); 
          pairs = [];
        }
      }
      if (pairs.length > 1) {
        repetitions.push(pairs); 
        pairs = [];
      }
    }

    return wordMatrix.reduceRepetitions(repetitions, searchDistance);
  };

  wordMatrix.reduceRepetitions = function(repetitions, searchDistance) {
    // —Å–æ–µ–¥–∏–Ω—è–µ—Ç –ø–æ–≤—Ç–æ—Ä—ã –≤ —Ü–µ–ø–æ—á–∫–∏, —á—Ç–æ–±—ã –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –æ–¥–Ω–∏–º —Ü–≤–µ—Ç–æ–º
    repetitions = repetitions.sort(function(a, b) { return a[0] - b[0]; });
    for (var r = 0; r < repetitions.length; ++r) {
      if (repetitions[r].length === 0) { continue; }
      for (var rr = r + 1; rr < repetitions.length; ++rr) {
        if ((repetitions[rr][0] - repetitions[r][repetitions[r].length - 1]) > searchDistance) {
          break; // –Ω–µ –ª–∏—Å—Ç–∞–µ—Ç –¥–∞–ª—å—à–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏
        }
        var intersections = repetitions[r].filter(function(item) {
          return (repetitions[rr].indexOf(item) !== -1); // —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Ü–µ–ø–æ—á–µ–∫
        }); 
        if (intersections.length > 0) {
          repetitions[r] = repetitions[r].concat(repetitions[rr].filter(function(item) {
            return (repetitions[r].indexOf(item) < 0);
          })).sort(function(a, b) { return a - b; });
          repetitions[rr] = [];
        }
      }
    }

    return repetitions;
  };

  return wordMatrix;
};

window.DuplicateWordsApp.WordFormsModule = function(dict) {
  "use strict";

  var wordFormsHandler = function(word) {
    if (dict.exceptions.indexOf(word) !== -1) {
      return [];
    }

    var wordRoot = word; // –∫–æ—Ä–µ–Ω—å –±–µ–∑ –∞—Ñ—Ñ–∏–∫—Å–æ–≤
    var wordRootPrefixed = word; // –∫–æ—Ä–µ–Ω—å —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–æ–π (–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
    var wordRootSuffixed = word; // –∫–æ—Ä–µ–Ω—å —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º (–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
    var wordRootMatched = false; // –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∫–æ—Ä–Ω—è

    if (dict.immutableRoots.indexOf(wordRoot) !== -1 || dict.unbreakableRoots.indexOf(wordRoot) !== -1) { 
      return [word, wordRoot, wordRootPrefixed, wordRootSuffixed]; 
    }

    for (var r = dict.unbreakableRoots.length - 1; r >= 0; --r) { // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∫–æ—Ä–Ω—è
      if (word.length < dict.unbreakableRoots[r].length) { 
        continue;
      }
      if (word.indexOf(dict.unbreakableRoots[r]) !== -1) {
        wordRootMatched = dict.unbreakableRoots[r];
        break;
      }
    }

    // –ø–æ—Ä—è–¥–æ–∫ –æ—Ç—Å–µ—á–µ–Ω–∏—è –∞—Ñ—Ñ–∏–∫—Å–æ–≤: —Ç–∏–ø + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è —É –∫–æ—Ä–Ω—è
    // (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∏—Å—Ç–∞–≤–æ–∫)
    var parseSequence = [
      [dict.endings, 2],
      [dict.suffixes, 2],
      [dict.suffixes, 3],
      [dict.prefixes, -3]
    ];

    // –µ—Å–ª–∏ —Å–ª–æ–≤–æ –¥–ª–∏–Ω–Ω–æ–µ, –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç—Å–µ—á–µ–Ω–∏–µ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤
    if (word.length > 12) {
      parseSequence.splice(2, 0, [dict.suffixes, 3]);
    }

    for (var p = 0; p < parseSequence.length; ++p) { // –æ—Ç—Å–µ—á–µ–Ω–∏–µ –∞—Ñ—Ñ–∏–∫—Å–æ–≤ –æ—Ç —Å–ª–æ–≤–∞
      var affixes = parseSequence[p][0]; 
      var minRootSize = parseSequence[p][1];
      var possibleAffixLength = wordRoot.length - Math.abs(minRootSize);
      var wordChunk = '';

      for (var i = affixes.length - 1; i >= 0; --i) {
        if (affixes[i].length > possibleAffixLength) {
          continue; 
        }
        if (minRootSize > 0 && affixes[i] === wordRoot.slice(affixes[i].length * -1)) {
          // –æ—Ç—Å–µ—á–µ–Ω–∏–µ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏–π
          wordChunk = wordRoot.slice(0, affixes[i].length * -1); // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–µ–Ω—å –±–µ–∑ –∞—Ñ—Ñ–∏–∫—Å–∞

          if (wordRootMatched && wordChunk.indexOf(wordRootMatched) === -1) { 
            continue; // –µ—Å–ª–∏ —á–∞—Å—Ç—å –∫–æ—Ä–Ω—è –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—Ç—Å–µ—á–µ–Ω–∏–∏ –∞—Ñ—Ñ–∏–∫—Å–∞, —Ç–æ –∏—â–µ—Ç—Å—è –¥—Ä—É–≥–æ–π
          }

          wordRoot = wordChunk;
          wordRootPrefixed = wordRoot;
          if (p == 1) { wordRootSuffixed = wordRoot; }
          break;
        }
        else if (minRootSize < 0 && affixes[i] === wordRoot.slice(0, affixes[i].length)) {
          // –æ—Ç—Å–µ—á–µ–Ω–∏–µ –ø—Ä–∏—Å—Ç–∞–≤–æ–∫
          wordChunk = wordRoot.slice(affixes[i].length);
          if (wordRootMatched && wordChunk.indexOf(wordRootMatched) === -1) { 
            continue; // –µ—Å–ª–∏ —á–∞—Å—Ç—å –∫–æ—Ä–Ω—è –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—Ç—Å–µ—á–µ–Ω–∏–∏ –∞—Ñ—Ñ–∏–∫—Å–∞, —Ç–æ –∏—â–µ—Ç—Å—è –¥—Ä—É–≥–æ–π
          }
          wordRoot = wordChunk;
          wordRootSuffixed = wordRootSuffixed.slice(affixes[i].length);
          break;
        }
      }
      if (dict.unbreakableRoots.indexOf(wordRoot) !== -1) { 
        break; 
      }
    }

//console.log([word, wordRoot, wordRootPrefixed, wordRootSuffixed]); 

    return [word, wordRoot, wordRootPrefixed, wordRootSuffixed];
  };

  return wordFormsHandler;
};

window.DuplicateWordsApp.DictionaryModule = function(lang) {
  "use strict";

  if (lang !== 'ru') {
    return null;
  }

  var dict = {};

  function parseMorphemes(line) { // –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —á–∞—Å—Ç–∏ —Å–ª–æ–≤ –≤ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
    return line.toLowerCase()
      .replace(/—ë/g, '–µ')
      .replace(/^[^–∞-—è]+/, '')
      .replace(/[^–∞-—è]+$/, '')
      .split(/[^–∞-—è]+/)
      .filter(function(value) { return value; })
      .sort(function(a, b) { return a.length - b.length; });
  }

  /*  –°–ü–û–†–ù–´–ï –°–õ–£–ß–ê–ò: 
      –ø–æ–ª–µ = –ø–æ–ª–µ—Ç <> –ª–µ—Ç–∞—Ç—å (!!!)
      –æ–¥–Ω–æ–∏–º–µ–Ω–Ω—ã–π <> –∏–º—è (!!!) - –∏–º–µ—é—â–∏–π
      –Ω–∞–ø—Ä–∞–≤–∏—Ç—å = –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ = —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ = –ø—Ä–∞–≤–æ
      –¥–µ–ª–∏—Ç—å = –¥–µ–ª–∞—Ç—å = —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–π = –¥–µ–ª–æ–≤–æ–π = –ù—å—é-–î–µ–ª–∏
      —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ = –∑–∞—Ç—Ä—É–¥–Ω–∏—Ç–µ–ª—å–Ω—ã–π
      –≤—ã—Ö–æ–¥–Ω–æ–π = –ø—Ä–æ—Ö–æ–¥–∏–ª
      —Å–≤–æ—ë = —Å–≤–µ–ª–∏
      –∏–¥–µ—Ç = –∏–¥–µ—è
      —Ü–µ–ª–æ–º = —Ü–µ–ª—è—Ö
      –Ω–∞—á–∏–Ω–∞—é—Ç = –Ω–∞—á–∏–Ω–∫–∞
      –ø–æ–Ω—è—Ç–∏–µ <> –ø–æ–Ω–∏–º–∞—Ç—å
      –ø—Ä–∏–Ω–∏–º–∞—Ç—å <> –ø—Ä–∏–º—É—Ç
      –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—â–∏–π = —Ä–µ—á—å
      –ø–æ—Å–ª–µ–¥–Ω–∏–π = –≤–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ = –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è ?? –≤—Å–ª–µ–¥—Å—Ç–≤–∏–µ = —Å–ª–µ–¥—É—é—â–µ–µ
      –æ–ø–ø–æ–Ω–µ–Ω—Ç <> –ø—Ä–æ–ø–æ–Ω–µ–Ω—Ç
      —Å–Ω–µ–≥ <> —Å–Ω–µ–∂–Ω—ã–π
      –ø—Ä–æ–≤–µ—Å—Ç–∏ <> –ø—Ä–æ–≤–æ–¥–∏—Ç—å
      –Ω–∞—Ö–æ–¥–∏—Ç—å <> –Ω–∞—à–µ–ª
      —Ç–µ–º–∞ = —Ç–µ–º–Ω—ã–π
      –≤–º–µ—Å—Ç–æ = –≤–º–µ—Å—Ç–µ
      –ø–µ—Ä–µ–¥–∞—á–∞ = –¥–∞—á–Ω—ã–π
      –ø–æ–¥—Å–∫–∞–∑–∫–∞ = –≤—ã—Å–∫–∞–∑–∞—Ç—å (?)
      —Ñ–æ—Ä–º–∞—Ç = —Ñ–æ—Ä–º–∞ = –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π (?)
      —É—Ö–æ–¥–∏—Ç—å = —Ä–∞—Å—Ö–æ–¥–Ω—ã–π (?)
      —Ä–∞—Å–ø–∞–¥ = –ø–æ–¥–ø–∞–¥–∞–µ—Ç (?)
      —Å–æ—Å—Ç–æ—è–Ω–∏–µ = –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ (?)
      —Å–ø—É—Ç–Ω–∏–∫ = –ø—É—Ç—å (?)
      –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è = –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (?)
      –Ω–µ—Å–º–æ—Ç—Ä—è = —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ (?)

      –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ <> –Ω–∞–ø—Ä—è–≥–∞—Ç—å
      –æ—Ç–≤–µ—Ç <> –æ—Ç–≤–µ—á–∞—Ç—å
      –≤—Ö–æ–¥–∏—Ç <> –≤–æ—à—ë–ª
      –±—ã–ª <> –±—É–¥–µ—Ç
  */

  // –ø–æ–≤—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è
  dict.exceptions = '–∏–∑, –∑–∞, –Ω–∞, –Ω–µ, –Ω–∏, –≤–æ, –ø–æ, –±—ã, –ª–∏, –∂–µ, –¥–∞, –¥–æ, –æ—Ç, –¥–ª—è, –ø–æ–¥, –Ω–∞–¥, –≥–≥';

  dict.immutableRoots = '–≤–º–µ—Å—Ç–µ, –≤–æ–æ–±—â–µ, –Ω–∞–∑–∞–¥, –Ω–∏–∫—Ç–æ, –ø–µ—Ä–µ–¥, –ø–æ–∫–∞, —Ä–∞–¥–∏, '+ 
    '—Ç–∞–º, —Ç–∞–∫, –∫–∞–∫, –∫—Ç–æ, —á—Ç–æ, —Ä–∞–∑, –≤–Ω–µ, –ø—Ä–∏, –ª–∏, –∏–º';

  dict.unbreakableRoots = parseMorphemes( // –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ—Ä–Ω–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω–æ —Ä–∞–∑–±–∏—Ç—ã
    '–±—É–¥–Ω, ' +
    '–≤–∞—à, –≤–µ–∫, –≤–µ—Ä, –≤–µ—Å, –≤–∏–¥, –≤–æ–¥, –≤—Ä–µ–¥, –≤–µ—á–µ—Ä, –≤–ª–∞—Å—Ç, –≤–æ–ø—Ä–æ—Å, –≤–æ–π–Ω, –≤—Ç–æ—Ä, –≤–µ–¥–æ–º—Å—Ç–≤, '+
    '–≤–æ—Å—Ç–æ, –≤–æ–∑—Ä–∞–∂, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤, –≤–µ—Ä–Ω, –≥–∞–∑–æ–Ω, '+
    '–¥–µ–ª, –¥–∞–Ω, –¥–∞—á, –¥–∞—Ç, –¥–æ—Ö–æ–¥, –¥–æ—Å—Ç—É–ø, –¥–æ–∫–ª–∞–¥, –¥–æ—Å—Ç–∞–≤, –¥–æ–ª–∂, '+
    '–∑–∞–∫–æ–Ω, –∑–∞—Å–ª–æ–Ω, –∑–∞–ø–∞–¥, –∑–∞–¥–∞—á, '+
    '–∏—é–Ω, –∏—é–ª, –∏—Å—Ç–æ—Ä, –∏–º–µ, –∏–¥–µ, –∏–∑–≤–µ—Å—Ç, ' +
    '–∫—Ä–∞—Ç, –∫—Ä—ã–ª, –ª–∏–Ω, –ª–µ—Ç, –ª–æ–º, '+
    '–º—ã—à, –º–∏—Ä, –º–µ—Ä, –º–µ–Ω, '+
    '–Ω–∞—à, –Ω–∞—á–∞–ª, –Ω–∞—á–∏–Ω, –Ω–µ–¥–µ–ª, –Ω–∞—Ö–æ–¥, –Ω–∞–ª–æ–≥, –Ω–∞—Ç–æ, –Ω–æ—Å, –Ω–∞–ø—Ä—è–∂, '+
    '–æ–±–ª–∞—Å—Ç, –æ–±—Ä–∞–∑, –æ—Å—Ç—Ä–æ–≤, –æ—Ç—Ä–∞–∂, –æ–±—Ä–µ—á, –æ—Å–æ–±, –æ–ø—Ä–µ–¥–µ–ª, –æ–±—Ä–∞—â, '+
    '–æ–ø–ø–æ–Ω, –æ–±—Å—Ç–∞–Ω–æ–≤, –æ—Ç–≤–µ—Ç, –æ—Ç—Ä–∞—Å–ª, –æ–±—ä–µ–º, –æ–±—ä–µ–∫—Ç, –æ–ø—Ä–æ–≤–µ—Ä, '+
    '–ø–æ–≤—Ç–æ—Ä, –ø—É—Ç, –ø–æ—Ä–∞, –ø–æ–ª—É—á, –ø–æ–ª–Ω, –ø—Ä–∞–≤, –ø—Ä–∞–≤–∏–ª, –ø—Ä–æ–µ–∫—Ç, –ø—Ä–æ—Å—Ç, –ø–æ—Å—Ç–∞–≤, '+ /* –ø—Ä–∞–≤–ª, */
    '–ø—Ä–æ—Ü–µ—Å—Å, –ø—Ä–µ—Å—Ç—É–ø, –ø–ª–∞–Ω–µ—Ç, –ø–æ–ª–∏—Ç, –ø–æ—Å–ª–µ–¥, –ø—Ä–æ–¥–æ–ª–∂, –ø—Ä–µ–¥–µ–ª, –ø–æ–≤–µ—Å—Ç–∫, '+
    '–ø—Ä–æ–≤–µ—Ä, –ø—Ä–µ–¥–ª–æ–∂, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤, –ø—Ä–∏–Ω–∏–º, –ø—Ä–∏–∑–Ω–∞, –ø–æ–ª, –ø–æ–ª–Ω, –ø—Ä–æ—Å, '+
    '–ø—Ä–æ–ø–æ–Ω, –ø—Ä–µ–∫—Ä–∞—Ç, –ø–æ—Ä—è–¥, –ø—Ä–∏–µ–º–ª, –ø—Ä–µ—Å–ª–æ–≤—É—Ç, '+
    '—Ä–∞–¥, —Ä–∞–∑–≤–∏—Ç, —Ä–∞–∑—Ä–∞–±–æ—Ç, '+
    '—Å–∏–¥, —Å–≤–∏–¥–µ, —Å–ª–µ–¥, —Å–ª–æ–≤, —Å–ª—É—á, —Å—Ç—Ä–∞–Ω, —Å–∏–ª, —Å–∏—Å—Ç–µ–º, —Å—Ä–µ–¥—Å—Ç–≤, —Å—Ç–æ–ª, —Å—Ç–æ–ª–∏—Ü, —Å–≤–µ–¥–µ–Ω, '+
    '—Å—Ç–æ—Ä–æ–Ω, —Å–≤—è–∑, —Å–∏—Ç—É–∞—Ü, —Å–æ—é–∑, —Å–æ–≤–µ—Ç, —Å—Ç–∞—Ç, —Å—É–≤–µ—Ä–µ–Ω, —Å–æ–¥–µ—Ä–∂, —Å–æ–≤–µ—Ä—à, —Å–≤–µ—Ç, —Å–ª–æ–Ω, '+
    '—Å–æ—Å—Ç–æ—è, —Å–∫–∞–∑, —Å–æ—Å—Ç–∞–≤, —Å—Ç—Ä–æ, —Å—Ç—Ä–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤, —Å–ø—Ä–∞–≤, —Å–∫–æ—Ä, —Å—Ç–æ, —Å—É—â–µ—Å—Ç–≤, '+
    '—Ç–∏—à, —Ç–µ—Å—Ç, —Ç–µ–∫—Å—Ç, —Ç–æ—á–∫, —Ç–æ–ª–∫, —Ç—Ä—É–¥, '+
    '—É–¥–µ–ª, —É—Å—Ç–∞–≤, —É—Å–ª–æ–≤, —É—á–∞—Å—Ç, —É–≤–∞–∂, —É—Å—Ç—É–ø, —É–ª–∏—Ü, —É–∫–∞–∑, —É–≤–µ–¥–æ–º, '+
    '—Ñ–æ—Ä–º—É–ª, —Ü–µ–Ω, —Ü–µ–ª, '+
    '—è—Å–Ω'
  );

  dict.prefixes = parseMorphemes(
    '–≤-, –≤–æ-, –≤–∑–æ-, –≤–Ω–µ-, –≤–Ω—É—Ç—Ä–∏-, –≤–æ–∑–æ-, –≤—ã-, –¥–æ-, –µ–∂–µ-, –∑–∞-, –∑–∞–∫–æ-,'+
    '–∏–∑–æ-, –∏—Å–ø–æ–¥-, –∫-, –∫–æ–µ-, –∫—É-, –º–µ–∂-, –º–µ–∂–¥–æ-, –º–µ–∂–¥—É-, –Ω–∞-, –Ω–∞–¥-, –Ω–∞–¥–æ-, '+
    '–Ω–∞–∏-, –Ω–µ-, –Ω–µ–¥–æ-, –Ω–∏-, –Ω–∏–∑–æ-, –æ-, –æ–±-, –æ–±–æ-, –æ–∫–æ–ª–æ-, –æ—Ç-, –æ—Ç–æ-, –ø–∞-, '+
    '–ø–µ—Ä–µ-, –ø–æ-, –ø–æ–¥-, –ø–æ–¥–æ-, –ø–æ–∑–∞-, –ø–æ—Å–ª–µ-, –ø—Ä–∞-, –ø—Ä–µ–¥-, –ø—Ä–µ–¥–∏-, –ø—Ä–µ–¥–æ-, –ø—Ä–æ-,'+
    '–ø—Ä–æ—Ç–∏–≤–æ-, —Ä–∞–∑–æ-, —Å-, —Å–æ-, —Å–≤–µ—Ä—Ö-, —Å—Ä–µ–¥–∏-, —Å—É-, —Ç—Ä–µ-, —É-, –±–µ–∑-, –±–µ—Å-, –≤–∑-,'+
    '–≤—Å-, –≤–æ–∑-, –≤–æ—Å-, –∏–∑-, –∏—Å-, –Ω–∏–∑-, –Ω–∏—Å-, –æ–±–µ–∑-, –æ–±–µ—Å-, —Ä–∞–∑-, —Ä–∞—Å-, —Ä–æ–∑-, —Ä–æ—Å-,'+
    '—Ä–∞–∑—ä-, –±–µ–∑—ä-, —Å—ä-, '+
    '—á–µ—Ä–µ–∑-, —á–µ—Ä–µ—Å-, —á—Ä–µ–∑-, —á—Ä–µ—Å-, –ø—Ä–µ-, –ø—Ä–∏-, –∑–ª–æ-, –≤–∑–∞–∏–º–æ-, –ø—Å–µ–≤–¥–æ-, –∞–Ω—Ç–∏-, –≥–µ–æ-,'+
    '–≤–µ–∑–¥–µ-, –º–Ω–æ–≥–æ-, –æ–¥–Ω–æ-, –Ω–µ–æ–¥–Ω–æ-, –¥–≤—É-, –¥–≤—É—Ö-, ' +
    '–º–µ–≥–∞-, —Å—É–ø–µ—Ä- '
  );

  dict.suffixes = parseMorphemes(
    '-–∞–π—à-, -–µ-, -–µ–µ-, -–µ–π-, -–µ–π—à-, -–∂–µ-, -—à–µ-, -–ª-, -–µ–ª-, -—Ç–∏, -—Ç—å, -–∏, -–∞—â-,'+
    '-—è—â-, -–≤—à-, -—à-, -—É—â-, -—é—â-, -–µ–º-, -–∏–º-, -–æ–º-, -–Ω–Ω-, -–µ–Ω–Ω-, -–æ–Ω–Ω-, -—Ç-, -–∏—Ç—å, -–∞-, -—è-,'+
    '-—É—á–∏-, -—é—á–∏-, -–≤—à–∏-, -—à–∏-, -–µ—Å-, -–µ–Ω-, -–µ—Ä-, -–π-, -–µ–π—à-, -–∞–π—à-, -–∫-, -–∏–∫-, '+
    '-–µ–∫-, -–æ–∫-, -—á–∏–∫, -—ë–∫-, -–µ–Ω—å–∫-, -–æ–Ω—å–∫-, -–µ—á–∫-, -–∏—á–∫-, -–∏—á-, -–Ω–∏—á-, -–æ—á–∫-, -–∞—à–∫-, -–∞—à–Ω-, -–∏—à–∫-, -–∞—à–µ–∫-'+
    '-—É—à–∫-, -—é—à–∫-, -—ã—à–∫-, -–µ—Ü-, -–∏—Ü-, -–µ–Ω–∫-, -–∏–Ω–∫-, -–æ–Ω–∫-, -–∏–Ω-, -–∏—â-, -—É—à–µ–∫, -—ã—à–µ–∫,'+
    '-—ë–Ω—ã—à, -–µ–Ω—å–∫-, -–æ–Ω—å–∫-, -–µ—Ö–æ–Ω—å–∫-, -–æ—Ö–∞–Ω—å–∫-, -—ë—à–µ–Ω—å–∫-, -–æ—à–µ–Ω—å–∫-, '+
    '-—é—Å–µ–Ω—å–∫-, -–µ–Ω–Ω-, -–æ–≤–∞—Ç-, -–µ–Ω—å–∫-, -–æ–Ω—å–∫-, -–µ–Ω–µ—á–∫–æ, -–æ–Ω–µ—á–∫–æ, -–µ–≤–∞—Ç, -–æ–≤–∞—Ç, -—Ç–µ–ª—å, -–∏—Ç–µ–ª—å, -–Ω–∏—Ç–µ–ª—å, '+
    '-—á–∏–∫, -—â–∏–∫, -–Ω–∏–∫, -–∏—Ä, -–Ω–∏—Ü-, -–∫-, -–∏—Ü-, -—é—Ö, -—ë–Ω–æ–∫, -—É—à–∫-, -—ã—à–∫-, -–æ—Å—Ç—å, -–æ—Å—Ç-, -—è–∫, -—É–Ω, -–∞—á, '+
    '-–∏–≤-, -–∏–≤–Ω-, -—á–∏–≤-, -–ª–∏–≤-, -–∏—Å—Ç-, -–∏–∑–º-, -—Å–∫-, -–µ—Å–∫-, -–æ–≤-, -–µ–≤-, -–Ω-, -–µ–≤–∏—Ç-, -–∏–Ω-, '+
    '-–æ–≤–∞-, -–µ–≤–∞-, -—ã–≤–∞-, -–∏-, -—è-, -–µ-, -–∞-, -–∞, -–æ, -—É, -–∏–π—Å–∫-, -—Å—Ç–≤-, -–µ—Å—Ç–≤, -–∞—Ä–Ω-, -–∞—Ä–∏–∫, -–∞—Ü-,'+
    '-–æ—Ç-, -–ª–æ–≥, -—å, '+
    '-—á–Ω-, -–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, -—è–≤—à-, -—è—é—â-, -–≤—Å–∫-, -–æ–≤—Å–∫-'
  ); // , -—Ö–æ–¥

  dict.endings = parseMorphemes(
    '-–∞, -–∞–º, -–∞–º–∏, -–∞—Å, -–∞—Ö, -–∞—è, -–µ, -–µ—ë, -–µ–π, -–µ–º, -–µ–º–∏, -–µ–º—è,'+
    '-–µ—Ö, -–µ—é, -—ë—Ç, -—ë—Ç–µ, -—ë—Ö, -—ë—à—å, -–∏, -–∏–µ, -–∏–π, -–∏—è, -–∏–º, -–∏–º–∏, -–∏—Ç,'+
    '-–∏—Ç–µ, -–∏—Ö, -–∏—à—å, -–∏—é, -–º–∏, -–º—è, -–æ, -–æ–≤, -–æ–≥–æ, -–æ–µ, -–æ—ë,'+
    '-–æ–π, -–æ–º, -–æ–º—É, -–æ—é, -—É, -—É–º, -—É–º—è, -—É—Ç, -—É—Ö, -—É—é, -—à—å, -—ã–π, -—ã–µ'+
    '-–∞, -—è, -—ã, -–∏, -–æ–≤, -–µ–π, -–µ, -–∞–º, -—è–º, -—É, -—é,'+ // —Å—É—â. –∏.–º.-–≤.–ø.
    '-–æ–π, -—ë–π, -–∞–º–∏, -—è–º–∏, -–æ–º, -–µ–º, -—ë–º, -–∞—Ö, -—è—Ö,'+ // —Å—É—â. —Ç.–ø.-–ø.–ø.
    '-—É, -—é, -–µ—à—å, -–µ—Ç, -–µ–º, -–µ—Ç–µ, -—É—Ç, -—é—Ç, -–∏—à—å, -–∏—Ç, -–∏–º, -–∏—Ç–µ, -–∞—Ç, -—è—Ç,'+ // –≥–ª. 1/2 —Å–ø—Ä—è–∂.
    '-—ã–π, -–∏–π, -–∞—è, -—è—è, -–æ–µ, -–µ–µ, -—ã–µ, -–∏–µ, -–æ–≥–æ, -–µ–≥–æ, -–æ–π, -–µ–π, -—ã—Ö, -–∏—Ö,'+ // –ø—Ä–∏–ª. –∏–º./—Ä–æ–¥.–ø.
    '-–æ–º—É, -–µ–º—É, -–æ–π, -–µ–π, -—ã–º, -–∏–º, -—É—é, -—é—é, -—ã–º–∏, -–∏–º–∏, -–æ–º, -–µ–º' + // –ø—Ä–∏–ª. –¥–∞—Ç./–≤–∏–Ω./—Ç–≤–æ—Ä.–ø.
    '-–∏–π—Å—è, -–µ–≥–æ—Å—è, -–µ–º—É—Å—è, -–∏–º—Å—è, -–µ–º—Å—è, -–∞—è—Å—è, -–µ–π—Å—è, -—É—é—Å—è, -–µ–µ—Å—è, ' + // –ø—Ä–∏—á–∞—Å—Ç–∏—è –µ–¥.—á.
    '-–∏–µ—Å—è, -–∏—Ö—Å—è, -–∏–º—Å—è, -–∏–º–∏—Å—è, -—Å—è' // –ø—Ä–∏—á–∞—Å—Ç–∏—è –º–Ω.—á.
    // —É–±—Ä–∞–Ω–æ: -–º,
  ); 

  return dict;
};

window.addEventListener('load', function() {
  "use strict";

  var dict = DuplicateWordsApp.DictionaryModule('ru');
  var wordFormsHandler = DuplicateWordsApp.WordFormsModule(dict);
  var wordMatrix = DuplicateWordsApp.DuplicatesFinderModule(wordFormsHandler);

  var ui = document.forms.repetitions; // text, distance, clear, up, summary
  ui.mock = document.querySelector('#mock');
  ui.indicator = document.querySelector('#indicator');
  ui.distance.value = 70; // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤
  ui.styles = document.querySelector('style');

  ui.viewUpdate = function(event) {
    if (!event || event.type !== 'resize') {
      ui.text.togglePlaceholder();
      ui.summary.update();
      ui.styles.innerHTML = '';
    }
    ui.autoResize(ui.text);
    ui.style.height = ui.text.scrollHeight;
  };

  ui.toggleState = function(state) {
    if (state === 'loading') {
      ui.submit.disabled = true;
      ui.distance.disabled = true;
      ui.clear.disabled = true;
    }
    else if (state === 'idle') {
      ui.submit.disabled = false;
      ui.distance.disabled = false;
      ui.clear.disabled = false;
    }
    if (ui.indicator.dataset && ui.indicator.dataset[state + 'Value']) {
      ui.indicator.innerHTML = ui.indicator.dataset[state + 'Value'];
    }
  };

  ui.summary.update = function(stat) {
    var summary = '';
    if (!stat) {
      summary += ''+
        '–¶–µ–ø–æ—á–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤: -\n\n'+ 
        '–ü–æ–≤—Ç–æ—Ä–æ–≤ –≤—Å–µ–≥–æ: -\n\n'+ 
        '–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: -\n';
    }
    else {
      summary += ''+
        '–¶–µ–ø–æ—á–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤: ' + stat.chains +'\n\n'+ 
        '–ü–æ–≤—Ç–æ—Ä–æ–≤ –≤—Å–µ–≥–æ: ' + stat.duplicates +'\n\n'+ 
        '–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: ' + stat.time + '–º—Å\n';
    }
    ui.summary.value = summary;
    ui.autoResize(ui.summary);
  };

  ui.text.togglePlaceholder = function() {
    if (ui.text.value === '') {
      if (ui.text.dataset && ui.text.dataset.placeholder) {
        ui.mock.innerHTML = ui.text.dataset.placeholder;
      }
    }
    else {
      ui.mock.innerHTML = ui.text.value;
    }
  };
  ui.autoResize = function(elem) {
    elem.style.overflowY = 'hidden';
    elem.style.marginTop = elem.scrollHeight + 'px'; 
    elem.style.minHeight = 0;
    elem.style.minHeight = elem.scrollHeight + 'px'; 
    elem.style.marginTop = 0;
  };
  ui.text.format = function() {
    this.value = this.value
      .replace(/\u0301/g, '') // —É–¥–∞–ª—è–µ—Ç —É–¥–∞—Ä–µ–Ω–∏–µ
      .replace(/\n+/g, "\n\n");
  };

  ui.text.addEventListener('input', ui.viewUpdate);
  //ui.text.addEventListener('keyup', ui.viewUpdate);
  ui.text.addEventListener('mouseup', function(event) {
    var text = ui.text.value;
    if (text !== '' && typeof ui.text.selectionStart !== 'undefined') {
      var wordsArray = wordMatrix.parseInputText(text.slice(0, ui.text.selectionStart));
      var wordPos = wordsArray.length - 1;
      var nodeList = ui.mock.querySelectorAll('span');
      var node;
      if (node = nodeList.item(wordPos)) {
        if (ui.styles && node.className && window.getComputedStyle) {
          var chainClass = node.className.match(/chain_[0-9_]+/); // –∫–ª–∞—Å—Å —Ü–µ–ø–æ—á–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤
          var color = window.getComputedStyle(node).getPropertyValue('color');
          color = color.replace(/rgb\(([0-9, ]+)\)/, 'rgba($1, 0.3)');
          ui.styles.innerHTML = '.' + chainClass + '{ background:'+ color +'; }';
        }

      }
    }
  });
  ui.text.parentNode.addEventListener('click', function(event) {
    ui.text.focus();
  });

  ui.submit.addEventListener('click', function(event) {
    event.preventDefault();
    ui.toggleState('loading');
    ui.text.format();
    setTimeout(function() {
      var stat = {
        chains: 0,
        duplicates: 0,
        time: Date.now()
      };
      var text = ui.text.value;
      if (text !== '') {
        var distance = parseInt(ui.distance.value);
        wordMatrix.build(text);
        var duplicatesChains = wordMatrix.getRepetitions(distance);
        var chainHighlightStyle = 0;
        var chainClass = '';
        ui.mock.innerHTML = text.replace(/([–ê-–Ø–Å–∞-—è—ëA-Za-z]+)/g, "<span>$1</span>");
        var nodeList = ui.mock.querySelectorAll('span');
        var node; 
        for(var r = 0; r < duplicatesChains.length; ++r) {
          if (duplicatesChains[r].length === 0) { continue; }
          ++chainHighlightStyle;
          chainClass = 'chain_' + duplicatesChains[r].join('_'); // –∫–ª–∞—Å—Å —Ü–µ–ø–æ—á–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤
          ++stat.chains;
          for(var p = 0; p < duplicatesChains[r].length; ++p) {
            if (node = nodeList.item(duplicatesChains[r][p])) {
              ++stat.duplicates;
              node.className = 'form-highlight ' + 
                'form-highlight' + (chainHighlightStyle % 10) + ' ' +
                chainClass;
            }
          }
        }
      }
      stat.time = Date.now() - stat.time;
      ui.summary.update(stat);
      ui.toggleState('idle');
    }, 1);
  });

  ui.clear.addEventListener('click', function(event) {
    event.preventDefault();
    ui.text.value = '';
    ui.text.focus();
    ui.viewUpdate(event);
  });

  ui.up.addEventListener('click', function(event) {
    event.preventDefault();
    window.scrollTo(0, 0);
  });

  ui.text.addEventListener('paste', function(event) {
    setTimeout(function() {
      ui.text.format();
      ui.viewUpdate(event);
    }, 1);
  });

  var resizeTimer = null;
  window.addEventListener('resize', function(event) {
    if (resizeTimer) { return null; }
    resizeTimer = setTimeout(function() {
      ui.viewUpdate(event);
      resizeTimer = null;
    }, 100);
  });

  ui.viewUpdate();
  ui.toggleState('idle');
});

  </script>
  </body>
</html>
